<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antifürst – Blog</title>
    <link rel="stylesheet" href="../css/format.css">
    <style>
        .post-menu {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .post-menu a,
        .post-menu button {
            background: #222;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.2s;
        }

        .post-menu a:hover,
        .post-menu button:hover {
            background: #444;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin: 2em 0;
            gap: 8px;
            flex-wrap: wrap;
        }

        .pagination button {
            background: #111;
            color: #fff;
            border: 1px solid #333;
            border-radius: 3px;
            padding: 6px 12px;
            cursor: pointer;
            font-family: monospace;
        }

        .pagination button.active {
            background: #444;
            border-color: #666;
        }

        .pagination button:hover:not(.active) {
            background: #333;
        }
    </style>
</head>

<body>
    <header style="background-color:#111111; color:#fff; text-align:center; padding:1em;">
        <h1>Antifürst-Blog</h1>
    </header>

    <main class="container" id="feed">
        <p>Beiträge werden geladen...</p>
    </main>

    <div class="pagination" id="pagination"></div>

    <footer style="background-color:#111111; color:#fff; text-align:center; padding:1em;">
        <p>© 2025 Ole Hinrich Bassen</p>
    </footer>

    <script>
        const feed = document.getElementById('feed');
        const pagination = document.getElementById('pagination');
        const postsFolder = 'posts/';
        const latestPostNumber = 12; // <-- höchste Postnummer
        const postsPerPage = 5;
        const totalPages = Math.ceil(latestPostNumber / postsPerPage);

        async function loadPage(page) {
            feed.innerHTML = ''; // leeren
            const start = latestPostNumber - (page - 1) * postsPerPage;
            const end = Math.max(start - postsPerPage + 1, 1);

            for (let i = start; i >= end; i--) {
                const postUrl = postsFolder + i + '.html';
                try {
                    const res = await fetch(postUrl);
                    if (!res.ok) continue;
                    const html = await res.text();

                    const wrapper = document.createElement('article');
                    wrapper.className = 'article';

                    const menu = document.createElement('div');
                    menu.className = 'post-menu';

                    // 🌐 Übersetzen mit Google Translate
                    const translateLink = document.createElement('a');
                    translateLink.textContent = 'Translate';
                    translateLink.href = `https://translate.google.com/translate?sl=de&tl=en&u=${encodeURIComponent(window.location.origin + window.location.pathname.replace(/\/[^/]*$/, '/') + postUrl)}`;
                    translateLink.target = '_blank';
                    translateLink.rel = 'noopener noreferrer';

                    // 🔍 Beitrag anzeigen
                    const viewLink = document.createElement('a');
                    viewLink.textContent = 'Show';
                    viewLink.href = postUrl;
                    viewLink.target = '_blank';

                    // 🔗 Teilen
                    const shareBtn = document.createElement('button');
                    shareBtn.textContent = 'Share';
                    shareBtn.addEventListener('click', () => {
                        const shareUrl = window.location.origin + window.location.pathname.replace(/\/[^/]*$/, '/') + postUrl;
                        if (navigator.share) {
                            navigator.share({
                                title: 'Antifürst – Blogbeitrag',
                                url: shareUrl
                            }).catch(err => console.warn('Share abgebrochen:', err));
                        } else {
                            navigator.clipboard.writeText(shareUrl)
                                .then(() => alert('Link kopiert: ' + shareUrl))
                                .catch(() => alert('Link: ' + shareUrl));
                        }
                    });

                    menu.appendChild(translateLink);
                    menu.appendChild(viewLink);
                    menu.appendChild(shareBtn);

                    const content = document.createElement('div');
                    content.innerHTML = html;

                    wrapper.appendChild(menu);
                    wrapper.appendChild(content);
                    feed.appendChild(wrapper);

                } catch (err) {
                    console.warn('Fehler beim Laden von Post ' + i + ':', err);
                }
            }

            renderPagination(page);
        }

        function renderPagination(currentPage) {
            pagination.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                if (i === currentPage) btn.classList.add('active');
                btn.addEventListener('click', () => loadPage(i));
                pagination.appendChild(btn);
            }
        }

        loadPage(1); // erste Seite laden
    </script>
</body>

</html>